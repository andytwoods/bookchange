<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Augmented Bookality</title>
    <link href="css/bootstrap.min.css" rel="stylesheet"
          integrity="sha384-gH2yIJqKdNHPEq0n4Mqa/HGKIhSkIHeL5AyhkYV8i59U5AR6csBvApHHNl/vI1Bx" crossorigin="anonymous">

</head>
<style>
    #drop_zone {
        border: 5px dotted blue;
        width: 100%;
        height: 100px;
        text-align: center;
    }

    .over_drag {
        background-color: gray;
    }
</style>
<body>
<h1>Augmented Bookality they'eriser</h1>
<p>This tool lets you convert all the pronouns in an ebook into they/them format. You can then read the book in popular
    ebook readers such as the Kindle (<a href="https://kindlepreneur.com/epub-to-kindle/" target="_blank">instructions</a>
    for the latter). Ebooks with images work too!</p>
<div class="container">
    <div class="row mt-4">
        <div class="col-sm-12 col-md-8">
            <div id="drop_zone" class='d-flex justify-content-center align-items-center text-center '
                 ondrop="dropHandler(event);"
                 ondragover="dragOverHandler(event)"
                 ondragleave="dragLeaveHandler(event)">

                <form method="post" enctype="multipart/form-data">
                    <div>
                        <label for="file">Drop an epub file here (many can be found in
                            <a target="_blank" href="https://www.gutenberg.org/">project Gutenberg</a>), or choose file
                            to
                            upload</label>
                        <input type="file" id="file" name="file">
                    </div>
                </form>
            </div>
        </div>
    </div>
    <div class="row mt-3">
        <div class="col">
            <div class="dropdown">
                Top 100 books on Project Gutenburg and direct link to epub download page (Sept 2022)
                <a class="btn btn-secondary dropdown-toggle" href="#" role="button" id="dropdownMenuLink" data-bs-toggle="dropdown" aria-expanded="false">
                    books
                </a>
                <ul class="dropdown-menu" aria-labelledby="dropdownMenuLink">
                    <li><a target="_blank" href="https://www.gutenberg.org/ebooks/1342">1. Pride and Prejudice by Jane Austen (2111)</a></li>
                    <li><a target="_blank" href="https://www.gutenberg.org/ebooks/84">2. Frankenstein; Or, The Modern Prometheus by Mary Wollstonecraft Shelley (1652)</a></li>
                    <li><a target="_blank" href="https://www.gutenberg.org/ebooks/1661">3. The Adventures of Sherlock Holmes by Arthur Conan Doyle (1044)</a></li>
                    <li><a target="_blank" href="https://www.gutenberg.org/ebooks/11">4. Alice's Adventures in Wonderland by Lewis Carroll (982)</a></li>
                    <li><a target="_blank" href="https://www.gutenberg.org/ebooks/16328">5. Beowulf: An Anglo-Saxon Epic Poem (876)</a></li>
                    <li><a target="_blank" href="https://www.gutenberg.org/ebooks/1952">6. The Yellow Wallpaper by Charlotte Perkins Gilman (869)</a></li>
                    <li><a target="_blank" href="https://www.gutenberg.org/ebooks/68923">7. An island hell: A Soviet prison in the far north by S. A. Malsagoff (860)</a></li>
                    <li><a target="_blank" href="https://www.gutenberg.org/ebooks/345">8. Dracula by Bram Stoker (816)</a></li>
                    <li><a target="_blank" href="https://www.gutenberg.org/ebooks/174">9. The Picture of Dorian Gray by Oscar Wilde (752)</a></li>
                    <li><a target="_blank" href="https://www.gutenberg.org/ebooks/25344">10. The Scarlet Letter by Nathaniel Hawthorne (709)</a></li>
                    <li><a target="_blank" href="https://www.gutenberg.org/ebooks/6130">11. The Iliad by Homer (664)</a></li>
                    <li><a target="_blank" href="https://www.gutenberg.org/ebooks/98">12. A Tale of Two Cities by Charles Dickens (653)</a></li>
                    <li><a target="_blank" href="https://www.gutenberg.org/ebooks/2701">13. Moby Dick; Or, The Whale by Herman Melville (649)</a></li>
                    <li><a target="_blank" href="https://www.gutenberg.org/ebooks/1080">14. A Modest Proposal by Jonathan Swift (628)</a></li>
                    <li><a target="_blank" href="https://www.gutenberg.org/ebooks/43">15. The Strange Case of Dr. Jekyll and Mr. Hyde by Robert Louis Stevenson (628)</a></li>
                    <li><a target="_blank" href="https://www.gutenberg.org/ebooks/2591">16. Grimms' Fairy Tales by Jacob Grimm and Wilhelm Grimm (627)</a></li>
                    <li><a target="_blank" href="https://www.gutenberg.org/ebooks/68921">17. The making of a man by W. D. Flatt (612)</a></li>
                    <li><a target="_blank" href="https://www.gutenberg.org/ebooks/2542">18. A Doll's House : a play by Henrik Ibsen (608)</a></li>
                    <li><a target="_blank" href="https://www.gutenberg.org/ebooks/64317">19. The Great Gatsby by F. Scott  Fitzgerald (608)</a></li>
                    <li><a target="_blank" href="https://www.gutenberg.org/ebooks/5200">20. Metamorphosis by Franz Kafka (579)</a></li>
                    <li><a target="_blank" href="https://www.gutenberg.org/ebooks/19942">21. Candide by Voltaire (565)</a></li>
                    <li><a target="_blank" href="https://www.gutenberg.org/ebooks/1497">22. The Republic by Plato (543)</a></li>
                    <li><a target="_blank" href="https://www.gutenberg.org/ebooks/1260">23. Jane Eyre: An Autobiography by Charlotte Brontë (542)</a></li>
                    <li><a target="_blank" href="https://www.gutenberg.org/ebooks/1232">24. The Prince by Niccolò Machiavelli (522)</a></li>
                    <li><a target="_blank" href="https://www.gutenberg.org/ebooks/2554">25. Crime and Punishment by Fyodor Dostoyevsky (495)</a></li>
                    <li><a target="_blank" href="https://www.gutenberg.org/ebooks/68918">26. Assignats by Henry Leverage (489)</a></li>
                    <li><a target="_blank" href="https://www.gutenberg.org/ebooks/23">27. Narrative of the Life of Frederick Douglass, an American Slave by Frederick Douglass (485)</a></li>
                    <li><a target="_blank" href="https://www.gutenberg.org/ebooks/1250">28. Anthem by Ayn Rand (472)</a></li>
                    <li><a target="_blank" href="https://www.gutenberg.org/ebooks/1400">29. Great Expectations by Charles Dickens (452)</a></li>
                    <li><a target="_blank" href="https://www.gutenberg.org/ebooks/15399">30. The Interesting Narrative of the Life of Olaudah Equiano, Or Gustavus Vassa, The African by Equiano (450)</a></li>
                    <li><a target="_blank" href="https://www.gutenberg.org/ebooks/68922">31. The adventure of the broad arrow: An Australian romance by Morley Roberts (448)</a></li>
                    <li><a target="_blank" href="https://www.gutenberg.org/ebooks/219">32. Heart of Darkness by Joseph Conrad (447)</a></li>
                    <li><a target="_blank" href="https://www.gutenberg.org/ebooks/7370">33. Second Treatise of Government by John Locke (444)</a></li>
                    <li><a target="_blank" href="https://www.gutenberg.org/ebooks/1727">34. The Odyssey by Homer (441)</a></li>
                    <li><a target="_blank" href="https://www.gutenberg.org/ebooks/408">35. The Souls of Black Folk by W. E. B.  Du Bois (437)</a></li>
                    <li><a target="_blank" href="https://www.gutenberg.org/ebooks/1184">36. The Count of Monte Cristo, Illustrated by Alexandre Dumas (431)</a></li>
                    <li><a target="_blank" href="https://www.gutenberg.org/ebooks/2600">37. War and Peace by graf Leo Tolstoy (428)</a></li>
                    <li><a target="_blank" href="https://www.gutenberg.org/ebooks/46">38. A Christmas Carol in Prose; Being a Ghost Story of Christmas by Charles Dickens (428)</a></li>
                    <li><a target="_blank" href="https://www.gutenberg.org/ebooks/851">39. Narrative of the Captivity and Restoration of Mrs. Mary Rowlandson by Mary White Rowlandson (420)</a></li>
                    <li><a target="_blank" href="https://www.gutenberg.org/ebooks/205">40. Walden, and On The Duty Of Civil Disobedience by Henry David Thoreau (417)</a></li>
                    <li><a target="_blank" href="https://www.gutenberg.org/ebooks/3207">41. Leviathan by Thomas Hobbes (404)</a></li>
                    <li><a target="_blank" href="https://www.gutenberg.org/ebooks/4300">42. Ulysses by James Joyce (401)</a></li>
                    <li><a target="_blank" href="https://www.gutenberg.org/ebooks/68920">43. Captain Balaam of the 'Cormorant': and other sea comedies by Morley Roberts (395)</a></li>
                    <li><a target="_blank" href="https://www.gutenberg.org/ebooks/41">44. The Legend of Sleepy Hollow by Washington Irving (395)</a></li>
                    <li><a target="_blank" href="https://www.gutenberg.org/ebooks/514">45. Little Women by Louisa May Alcott (367)</a></li>
                    <li><a target="_blank" href="https://www.gutenberg.org/ebooks/28054">46. The Brothers Karamazov by Fyodor Dostoyevsky (365)</a></li>
                    <li><a target="_blank" href="https://www.gutenberg.org/ebooks/30254">47. The Romance of Lust: A classic Victorian erotic novel by Anonymous (359)</a></li>
                    <li><a target="_blank" href="https://www.gutenberg.org/ebooks/768">48. Wuthering Heights by Emily Brontë (355)</a></li>
                    <li><a target="_blank" href="https://www.gutenberg.org/ebooks/844">49. The Importance of Being Earnest: A Trivial Comedy for Serious People by Oscar Wilde (349)</a></li>
                    <li><a target="_blank" href="https://www.gutenberg.org/ebooks/74">50. The Adventures of Tom Sawyer, Complete by Mark Twain (348)</a></li>
                    <li><a target="_blank" href="https://www.gutenberg.org/ebooks/105">51. Persuasion by Jane Austen (342)</a></li>
                    <li><a target="_blank" href="https://www.gutenberg.org/ebooks/45">52. Anne of Green Gables by L. M.  Montgomery (335)</a></li>
                    <li><a target="_blank" href="https://www.gutenberg.org/ebooks/68914">53. The traitor's way by S.  Levett Yeats (331)</a></li>
                    <li><a target="_blank" href="https://www.gutenberg.org/ebooks/35">54. The Time Machine by H. G.  Wells (329)</a></li>
                    <li><a target="_blank" href="https://www.gutenberg.org/ebooks/2814">55. Dubliners by James Joyce (325)</a></li>
                    <li><a target="_blank" href="https://www.gutenberg.org/ebooks/5827">56. The Problems of Philosophy by Bertrand Russell (320)</a></li>
                    <li><a target="_blank" href="https://www.gutenberg.org/ebooks/120">57. Treasure Island by Robert Louis Stevenson (319)</a></li>
                    <li><a target="_blank" href="https://www.gutenberg.org/ebooks/76">58. Adventures of Huckleberry Finn by Mark Twain (313)</a></li>
                    <li><a target="_blank" href="https://www.gutenberg.org/ebooks/55">59. The Wonderful Wizard of Oz by L. Frank  Baum (303)</a></li>
                    <li><a target="_blank" href="https://www.gutenberg.org/ebooks/1974">60. The Poetics of Aristotle by Aristotle (302)</a></li>
                    <li><a target="_blank" href="https://www.gutenberg.org/ebooks/5740">61. Tractatus Logico-Philosophicus by Ludwig Wittgenstein (296)</a></li>
                    <li><a target="_blank" href="https://www.gutenberg.org/ebooks/68915">62. Modern literature: a novel, Volume I (of 3) by Robert Bisset (296)</a></li>
                    <li><a target="_blank" href="https://www.gutenberg.org/ebooks/20203">63. Autobiography of Benjamin Franklin by Benjamin Franklin (294)</a></li>
                    <li><a target="_blank" href="https://www.gutenberg.org/ebooks/67098">64. Winnie-the-Pooh by A. A.  Milne (292)</a></li>
                    <li><a target="_blank" href="https://www.gutenberg.org/ebooks/58585">65. The Prophet by Kahlil Gibran (290)</a></li>
                    <li><a target="_blank" href="https://www.gutenberg.org/ebooks/13701">66. The Philippine Islands, 1493-1898 — Volume 07 of 55 (286)</a></li>
                    <li><a target="_blank" href="https://www.gutenberg.org/ebooks/36">67. The War of the Worlds by H. G.  Wells (285)</a></li>
                    <li><a target="_blank" href="https://www.gutenberg.org/ebooks/996">68. Don Quixote by Miguel de Cervantes Saavedra (269)</a></li>
                    <li><a target="_blank" href="https://www.gutenberg.org/ebooks/160">69. The Awakening, and Selected Short Stories by Kate Chopin (266)</a></li>
                    <li><a target="_blank" href="https://www.gutenberg.org/ebooks/8492">70. The King in Yellow by Robert W.  Chambers (264)</a></li>
                    <li><a target="_blank" href="https://www.gutenberg.org/ebooks/730">71. Oliver Twist by Charles Dickens (258)</a></li>
                    <li><a target="_blank" href="https://www.gutenberg.org/ebooks/4363">72. Beyond Good and Evil by Friedrich Wilhelm Nietzsche (251)</a></li>
                    <li><a target="_blank" href="https://www.gutenberg.org/ebooks/2852">73. The Hound of the Baskervilles by Arthur Conan Doyle (250)</a></li>
                    <li><a target="_blank" href="https://www.gutenberg.org/ebooks/68919">74. The promotion of the admiral: and other sea comedies by Morley Roberts (247)</a></li>
                    <li><a target="_blank" href="https://www.gutenberg.org/ebooks/16">75. Peter Pan by J. M.  Barrie (246)</a></li>
                    <li><a target="_blank" href="https://www.gutenberg.org/ebooks/1597">76. Andersen's Fairy Tales by H. C.  Andersen (238)</a></li>
                    <li><a target="_blank" href="https://www.gutenberg.org/ebooks/215">77. The Call of the Wild by Jack London (238)</a></li>
                    <li><a target="_blank" href="https://www.gutenberg.org/ebooks/203">78. Uncle Tom's Cabin by Harriet Beecher Stowe (237)</a></li>
                    <li><a target="_blank" href="https://www.gutenberg.org/ebooks/236">79. The Jungle Book by Rudyard Kipling (235)</a></li>
                    <li><a target="_blank" href="https://www.gutenberg.org/ebooks/61">80. The Communist Manifesto by Friedrich Engels and Karl Marx (234)</a></li>
                    <li><a target="_blank" href="https://www.gutenberg.org/ebooks/1399">81. Anna Karenina by graf Leo Tolstoy (233)</a></li>
                    <li><a target="_blank" href="https://www.gutenberg.org/ebooks/10007">82. Carmilla by Joseph Sheridan Le Fanu (230)</a></li>
                    <li><a target="_blank" href="https://www.gutenberg.org/ebooks/244">83. A Study in Scarlet by Arthur Conan Doyle (229)</a></li>
                    <li><a target="_blank" href="https://www.gutenberg.org/ebooks/3600">84. Essays of Michel de Montaigne — Complete by Michel de Montaigne (227)</a></li>
                    <li><a target="_blank" href="https://www.gutenberg.org/ebooks/33283">85. Calculus Made Easy by Silvanus P.  Thompson (227)</a></li>
                    <li><a target="_blank" href="https://www.gutenberg.org/ebooks/521">86. The Life and Adventures of Robinson Crusoe by Daniel Defoe (225)</a></li>
                    <li><a target="_blank" href="https://www.gutenberg.org/ebooks/15776">87. The Economic Consequences of the Peace by John Maynard Keynes (222)</a></li>
                    <li><a target="_blank" href="https://www.gutenberg.org/ebooks/27827">88. The Kama Sutra of Vatsyayana by Vatsyayana (221)</a></li>
                    <li><a target="_blank" href="https://www.gutenberg.org/ebooks/10">89. The King James Version of the Bible (218)</a></li>
                    <li><a target="_blank" href="https://www.gutenberg.org/ebooks/158">90. Emma by Jane Austen (217)</a></li>
                    <li><a target="_blank" href="https://www.gutenberg.org/ebooks/766">91. David Copperfield by Charles Dickens (216)</a></li>
                    <li><a target="_blank" href="https://www.gutenberg.org/ebooks/147">92. Common Sense by Thomas Paine (213)</a></li>
                    <li><a target="_blank" href="https://www.gutenberg.org/ebooks/135">93. Les Misérables by Victor Hugo (213)</a></li>
                    <li><a target="_blank" href="https://www.gutenberg.org/ebooks/20228">94. Noli Me Tangere by José Rizal (212)</a></li>
                    <li><a target="_blank" href="https://www.gutenberg.org/ebooks/3296">95. The Confessions of St. Augustine by Bishop of Hippo Saint Augustine (211)</a></li>
                    <li><a target="_blank" href="https://www.gutenberg.org/ebooks/42324">96. Frankenstein; Or, The Modern Prometheus by Mary Wollstonecraft Shelley (209)</a></li>
                    <li><a target="_blank" href="https://www.gutenberg.org/ebooks/161">97. Sense and Sensibility by Jane Austen (207)</a></li>
                    <li><a target="_blank" href="https://www.gutenberg.org/ebooks/11030">98. Incidents in the Life of a Slave Girl, Written by Herself by Harriet A.  Jacobs (205)</a></li>
                    <li><a target="_blank" href="https://www.gutenberg.org/ebooks/37134">99. The Elements of Style by William Strunk (204)</a></li>
                    <li><a target="_blank" href="https://www.gutenberg.org/ebooks/4517">100. Ethan Frome by Edith Wharton (202)</a></li>
                </ul>
            </div>


        </div>
    </div>

    <div class="row mt-3">
        <label>
            <input id='text-page' type="text" height="200px" width="100%" placeholder="paste text to change...">
        </label>
    </div>
    <script>
        document.getElementById('text-page').addEventListener("input", function(){
            this.value = modify_text(this.value);
        });
    </script>
</div>

<script>
    function top100(){
        fetch('https://www.gutenberg.org/ebooks/1342.kindle.images',{
            mode: 'cors',
        }).then(function (response) {
            // The API call was successful!
            return response.text();
        }).then(function (html) {
            // This is the HTML from our response as a text string
            console.log(111, html);
        }).catch(function (err) {
            // There was an error
            console.warn('Something went wrong.', err);
        });
    }
</script>

<script>

    var click_file = document.getElementById('file');
    click_file.onchange = e => {
        var file = e.target.files[0];
        process_dropped_zip(file);
    }

    function dragOverHandler(ev) {
        document.getElementById('drop_zone').classList.add("over_drag");
        ev.preventDefault();
    }

    function dragLeaveHandler(ev) {
        document.getElementById('drop_zone').classList.remove("over_drag");
    }

    function dropHandler(ev) {
        dragLeaveHandler();
        console.log('File(s) dropped');

        // Prevent default behavior (Prevent file from being opened)
        ev.preventDefault();

        if (ev.dataTransfer.items) {
            // Use DataTransferItemList interface to access the file(s)
            [...ev.dataTransfer.items].forEach((item, i) => {
                // If dropped items aren't files, reject them
                if (item.kind === 'file') {
                    const file = item.getAsFile();
                    process_dropped_zip(file);
                    console.log(`… file[${i}].name = ${file.name}`);
                }
            });
        } else {
            // Use DataTransfer interface to access the file(s)
            [...ev.dataTransfer.files].forEach((file, i) => {
                process_dropped_zip(file);
                console.log(`… file[${i}].name = ${file.name}`);
            });
        }
    }

    function process_dropped_zip(dropped_zip) {
        var new_zip = new JSZip();

        new_zip.loadAsync(dropped_zip)
            .then(function (zip) {
                process_zip_contents(zip)
            });
    }

    function process_zip_contents(zip) {
        var wait_til_done = [];
        for (const file_nam in zip.files) {
            var file = zip.files[file_nam];
            if (file_nam.endsWith('html')) {
                wait_til_done.push(file_nam);
                zip.file(file.name).async("string").then(function (data) {
                    var modded_text = modify_text(data);
                    zip.file(file_nam, modded_text);
                    wait_til_done.splice(wait_til_done.indexOf(file_nam), 1);
                    console.log(wait_til_done, 22)
                    if (wait_til_done.length === 0) generate_zip(zip);
                });
            }
        }
    }

    function generate_zip(zip) {
        zip.generateAsync({type: "blob"})
            .then(function (blob) {
                saveAs(blob, "hello3.epub");
            });
    }

    function modify_text(text) {
        // taken from https://github.com/amity/gender-neutralize/blob/master/replacement.js
        // needs proper attribution
        text = text.replace(/\b(s)?he was\b/g, "they were");
        text = text.replace(/\bShe was\b/g, "They were");
        text = text.replace(/\bHe was\b/g, "They were");
        text = text.replace(/\b(s)?he has\b/g, "they have");
        text = text.replace(/\bShe has\b/g, "They have");
        text = text.replace(/\bHe has\b/g, "They have");
        text = text.replace(/\bHe's\b/g, "They're");
        text = text.replace(/\bShe's\b/g, "They're");
        text = text.replace(/\b(s)?he's/g, "they're");
        text = text.replace(/\bhe has\b/g, "they have");
        text = text.replace(/\bHe has\b/g, "They have");
        text = text.replace(/\bHe is\b/g, "They are");
        text = text.replace(/\bShe is\b/g, "They are");
        text = text.replace(/\b(s)?he is\b/g, "they are");
        text = text.replace(/\b(she )([^ ]+)(s\b)/, "they $2");
        text = text.replace(/\b(he )([^ ]+)(s\b)/, "they $2");
        text = text.replace(/\b(She )([^ ]+)(s\b)/, "They $2");
        text = text.replace(/\b(He )([^ ]+)(s\b)/, "They $2");
        // Imperfect below -- but "her" as subject / possessive are tough
        text = text.replace(/\bher$/g, "them");
        text = text.replace(/ing her\b/g, "ing them");
        text = text.replace(/\b(s)?he\b/g, "they");
        text = text.replace(/\b(s)?he\b/g, "they");
        text = text.replace(/\bHe\b/g, "They");
        text = text.replace(/\bShe\b/g, "They");
        text = text.replace(/\bhers\b/g, "theirs");
        text = text.replace(/\bHers\b/g, "Theirs");
        text = text.replace(/\bhim\b/g, "them");
        text = text.replace(/\bHim\b/g, "Them");
        text = text.replace(/\bHis\b/g, "Their");
        text = text.replace(/\bhis\b/g, "their");
        text = text.replace(/\bher\b/g, "their");
        text = text.replace(/\bHer\b/g, "Their");
        text = text.replace(/\bhimself\b/g, "themselves");
        text = text.replace(/\bherself\b/g, "themselves");
        return text;
    }
</script>
<script src="js/bootstrap.bundle.min.js"
        integrity="sha384-A3rJD856KowSb7dwlZdYEkO39Gagi7vIsF0jrRAoQmDKKtQBHUuLZ9AsSv4jD4Xa"
        crossorigin="anonymous"></script>
<script src="js/jszip.min.js" crossorigin="anonymous"></script>
<script src="js/FileSaver.min.js" crossorigin="anonymous"></script>
</body>
</html>